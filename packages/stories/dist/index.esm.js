import{jsxs as e,jsx as n}from"react/jsx-runtime";import{createContext as t,useState as r,useRef as o,Fragment as i,useEffect as u,useContext as s,useMemo as c}from"react";var a=function(){return a=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},a.apply(this,arguments)},l=t({stories:[],width:"100%",height:"100%",defaultDuration:1e4,isPaused:!1});Object.freeze({MOUSE_DOWN:"mouseDown",MOUSE_UP:"mouseUp",TOUCH_START:"touchStart",TOUCH_END:"touchEnd"});var d=Object.freeze({LEFT:"left",RIGHT:"right"}),v="Actions-styles_left__eky50",f="Actions-styles_right__zguoH";function y(t){var u=t.onNextClick,s=t.onPrevClick,c=t.onPause,l=t.onResume,y=r(!1),m=y[0],h=y[1],p=o(null);function _(e){e.stopPropagation(),e.preventDefault(),clearTimeout(p.current),p.current=setTimeout((function(){c(),h(!0)}),200)}function w(e,n){if(n.stopPropagation(),n.preventDefault(),clearTimeout(p.current),m)return l(),void h(!1);l(),e!=d.LEFT?u():s()}function g(e){return{onMouseUp:function(n){return w(e,n)},onTouchEnd:function(n){return w(e,n)},onTouchStart:function(e){return _(e)},onMouseDown:function(e){return _(e)}}}return e(i,{children:[n("div",a({className:v},g(d.LEFT))),n("div",a({className:f},g(d.RIGHT)))]})}function m(){return s(l)}var h="ProgressBar-styles_wrapper__oqUCo",p="ProgressBar-styles_bar__x0O50",_=0,w=.1;function g(e){var t,i,s,c,l,d=m(),v=d.defaultDuration,f=d.classNames,y=o(null),g=o(null),x=r(!1),P=x[0],S=x[1];return u((function(){!e.isPaused&&e.isActive&&e.isActive?S(!0):S(!1)}),[e.isActive,e.isPaused]),u((function(){var n;y.current&&(e.hasStoryPassed?y.current.style.width="".concat(null===(n=null==g?void 0:g.current)||void 0===n?void 0:n.offsetWidth,"px"):y.current.style.width="0px")}),[e.hasStoryPassed,e.isActive]),t=function(n){var t;y.current&&g.current&&((_=Number((y.current.style.width||"1px").slice(0,y.current.style.width.length-2))||0)>g.current.offsetWidth?S(!1):(w=(null===(t=null==g?void 0:g.current)||void 0===t?void 0:t.offsetWidth)/((e.story.duration||v)/n),y.current.style.width="".concat(_+w,"px")))},i=P,s=o(),c=o(),l=o(t),u((function(){l.current=t}),[t]),u((function(){return!1!==i?(s.current=requestAnimationFrame((function e(n){if(null!=c.current){var t=n-c.current;l.current(t)}c.current=n,s.current=requestAnimationFrame(e)})),function(){cancelAnimationFrame(s.current),s.current=null,c.current=null}):function(){s.current&&(s.current=null),cancelAnimationFrame(s.current),c.current=null}}),[i]),n("div",a({className:"".concat(h," ").concat((null==f?void 0:f.progressBarContainer)||""),ref:g},{children:n("div",{className:"".concat(p," ").concat((null==f?void 0:f.progressBar)||""),ref:y})}))}var x="progress-styles_wrapper__qQPyW";function P(e){var t=m(),r=t.stories,o=t.classNames;return n("div",a({className:"".concat(x," ").concat((null==o?void 0:o.progressContainer)||""),style:{gridTemplateColumns:"repeat(".concat(r.length,",1fr)")}},{children:r.map((function(t){return n(g,{hasStoryPassed:t.index<e.activeStoryIndex,isActive:t.index===e.activeStoryIndex,story:t,isPaused:t.index===e.activeStoryIndex&&e.isPaused},t.index)}))}))}var S=Object.freeze({IMAGE:"image",VIDEO:"video",COMPONENT:"component"}),M="Story-styles_wrapper__oJP7j",N="Story-styles_header__-rnWL",C="Image-styles_image__gnfW1";function T(e){return u((function(){e.onPause()}),[]),n("img",{className:C,src:e.story.url,alt:"story",onLoad:function(){setTimeout((function(){e.onResume()}),4)}})}var E,I="Video-styles_video__BykuO",O="Video-styles_loaderWrapper__TqVWk",D="Video-styles_loader__FxxSV",b="Video-styles_soundIcon__ZvYXE";function A(e){return"off"===e.type?n("svg",a({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"white"},{children:n("path",{d:"M3 9v6h-1v-6h1zm13-7l-9 5v2.288l7-3.889v13.202l-7-3.889v2.288l9 5v-20zm-11 5h-5v10h5v-10zm17.324 4.993l1.646-1.659-1.324-1.324-1.651 1.67-1.665-1.648-1.316 1.318 1.67 1.657-1.65 1.669 1.318 1.317 1.658-1.672 1.666 1.653 1.324-1.325-1.676-1.656z"})})):n("svg",a({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"white"},{children:n("path",{d:"M22 0v24l-11-6v-2.278l9 4.909v-17.262l-9 4.91v-2.279l11-6zm-13 6v12h-7v-12h7zm-2 2h-3v8h3v-8z"})}))}var k="RSIsMute",W="undefined"==typeof window?{}:window;function z(t){var s,c=m().isPaused,l=r("true"===(null===(s=null==W?void 0:W.localStorage)||void 0===s?void 0:s.getItem(k))),d=l[0],v=l[1],f=r(!1),y=f[0],h=f[1],p=o(null);function _(e){var n;null===(n=null==W?void 0:W.localStorage)||void 0===n||n.setItem(k,String(e)),v(e)}return u((function(){t.onPause(),h(!0)}),[]),u((function(){p.current&&(!c||p.current.paused?p.current.play().catch((function(){var e;_(!0),null===(e=p.current)||void 0===e||e.play()})):p.current.pause())}),[c]),e(i,{children:[e("video",a({className:I,ref:p,playsInline:!0,"webkit-playsinline":"",controls:!1,src:t.story.url,onLoadedData:function(){setTimeout((function(){t.onResume(),h(!1)}),4)},muted:d},{children:[n("source",{src:t.story.url,type:"video/mp4"}),n("source",{src:t.story.url,type:"video/webm"}),n("source",{src:t.story.url,type:"video/ogg"}),n("p",{children:"Video not supported"})]})),n("div",a({className:b,onClick:function(){return _(!d)}},{children:n(A,{type:d?"off":"on"})})),y&&n("div",a({className:O},{children:n("div",{className:D})}))]})}null===(E=null==W?void 0:W.localStorage)||void 0===E||E.setItem(k,"true");var L="CustomComponents-styles_component__w87Wx";function R(e){return n("div",a({className:L},{children:n(e.story.component,{pause:e.onPause,resume:e.onResume,story:e.story,isPaused:e.isPaused})}))}var F="SeeMore-styles_seeMoreWrapper__kwjif",V="SeeMore-styles_defaultSeeMore__-B1QW";function j(t){return t.story.seeMore?n("button",a({type:"button",onClick:function(){t.onSeeMoreClick()},className:F},{children:function(){var r=t.story.seeMore,o=typeof r;if(["string","boolean"].includes(o)){var i="string"===o?r:"See More";return e("div",a({className:V},{children:[n("span",{children:"^"}),n("p",{children:i})]}))}return"function"===o?n(t.story.seeMore,{}):t.story.seeMore}()})):null}var B="SeeMoreComponent-styles_seeMoreComponentWrapper__0T6Ap",U="SeeMoreComponent-styles_closeIcon__LMm3b";function q(t){return t.story.seeMore&&t.story.seeMoreComponent?e("div",a({className:B},{children:[n("button",a({className:U,onClick:t.onClose},{children:"âœ•"})),"function"==typeof t.story.seeMoreComponent?n(t.story.seeMoreComponent,{}):t.story.seeMoreComponent]})):null}function H(t){var o=r(!1),i=o[0],s=o[1],c=m().classNames;return u((function(){s(!1)}),[t.story]),e("div",a({className:"".concat(M," ").concat((null==c?void 0:c.storyContainer)||"")},{children:[t.story.type===S.IMAGE?n(T,a({},t)):t.story.type===S.VIDEO?n(z,a({},t)):t.story.type===S.COMPONENT?n(R,a({},t)):null,t.story.header&&n("div",a({className:N},{children:"function"==typeof t.story.header?n(t.story.header,{}):t.story.header})),n(j,{onSeeMoreClick:function(){var e,n;t.onPause(),s(!0),null===(n=(e=t.story).onSeeMoreClick)||void 0===n||n.call(e,t.story.index)},story:t.story}),i&&n(q,{story:t.story,onClose:function(){t.onResume(),s(!1)}})]}))}var G="styles_main__-0FEu";function Q(e){return void 0===e&&(e=4),Number(Math.random().toFixed(e))}function J(t){var i,s,d,v,f,m,h,p=t.stories,_=void 0===p?[]:p,w=t.width,g=void 0===w?"100%":w,x=t.height,S=void 0===x?"100%":x,M=t.onStoryChange,N=void 0===M?function(){}:M,C=t.currentIndex,T=void 0===C?0:C,E=t.defaultDuration,I=void 0===E?1e4:E,O=t.onAllStoriesEnd,D=void 0===O?function(){}:O,b=t.onStoriesStart,A=void 0===b?function(){}:b,k=t.classNames,W=void 0===k?{}:k,z=t.pauseStoryWhenInActiveWindow,L=void 0===z||z,R=c((function(){return function(e,n){var t=0;return e.map((function(e,r){var o=e.duration||n,i=o+Q();return i===t&&(i=o+Q(6)),t=i,a(a({},e),{index:r,calculatedDuration:i})}))}(_,I)}),[_,I]),F=r(),V=F[0],j=F[1],B=_.length-1,U=r(!1),q=U[0],J=U[1],X=o(!1),Y=o(!1);function Z(){X.current||(null==V?void 0:V.index)!==B||(D(),X.current=!0),(null==V?void 0:V.index)!==B&&j((function(e){if(!e)return R[0];var n=(null==e?void 0:e.index)+1;return R[n]}))}function K(){J(!0)}function $(){J(!1)}u((function(){Y.current||(Y.current=!0,A())}),[A]),u((function(){var e=R[T];e&&j(e)}),[T,_]),u((function(){V&&N(V.index)}),[V]),s=function(){Z()},d=null!==(i=null==V?void 0:V.calculatedDuration)&&void 0!==i?i:null,v=q,f=o(),m=o(d),h=o(Date.now()),u((function(){f.current=s}),[s]),u((function(){m.current=d}),[d]),u((function(){if(null!==d&&!1===v){h.current=Date.now();var e=setTimeout((function(){f.current()}),m.current);return function(){clearTimeout(e)}}return function(){}}),[d,v]),u((function(){v&&(m.current=m.current-(Date.now()-h.current))}),[v]),function(e){var n=o(e);u((function(){n.current=e}),[e]),u((function(){function e(){n.current(!0)}function t(){n.current(!1)}return window.addEventListener("focus",e),window.addEventListener("blur",t),function(){window.removeEventListener("focus",e),window.removeEventListener("blur",t)}}),[])}((function(e){L&&J(!e)}));var ee={stories:R,width:g,height:S,defaultDuration:I,isPaused:q,classNames:W};return V?n(l.Provider,a({value:ee},{children:e("div",a({className:"".concat(G," ").concat(W.main||""),style:{width:g,height:S}},{children:[n(P,{activeStoryIndex:V.index,isPaused:q}),n(H,{onPause:K,onResume:$,story:V,isPaused:q},V.index),n(y,{onNextClick:Z,onPrevClick:function(){0!==(null==V?void 0:V.index)&&j((function(e){if(!e)return R[0];var n=(null==e?void 0:e.index)-1;return R[n]}))},onPause:K,onResume:$})]}))})):null}export{J as default};
//# sourceMappingURL=index.esm.js.map
