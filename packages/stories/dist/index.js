"use strict";var e=require("react/jsx-runtime"),n=require("react"),t=function(){return t=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},t.apply(this,arguments)},r=n.createContext({stories:[],width:"100%",height:"100%",defaultDuration:1e4,isPaused:!1});Object.freeze({MOUSE_DOWN:"mouseDown",MOUSE_UP:"mouseUp",TOUCH_START:"touchStart",TOUCH_END:"touchEnd"});var o=Object.freeze({LEFT:"left",RIGHT:"right"}),s="Actions-styles_left__eky50",u="Actions-styles_right__zguoH";function i(r){var i=r.onNextClick,c=r.onPrevClick,a=r.onPause,l=r.onResume,d=n.useState(!1),f=d[0],v=d[1],y=n.useRef(null);function m(e){e.stopPropagation(),e.preventDefault(),clearTimeout(y.current),y.current=setTimeout((function(){a(),v(!0)}),200)}function h(e,n){if(n.stopPropagation(),n.preventDefault(),clearTimeout(y.current),f)return l(),void v(!1);l(),e!=o.LEFT?i():c()}function x(e){return{onMouseUp:function(n){return h(e,n)},onTouchEnd:function(n){return h(e,n)},onTouchStart:function(e){return m(e)},onMouseDown:function(e){return m(e)}}}return e.jsxs(n.Fragment,{children:[e.jsx("div",t({className:s},x(o.LEFT))),e.jsx("div",t({className:u},x(o.RIGHT)))]})}function c(){return n.useContext(r)}var a="ProgressBar-styles_wrapper__oqUCo",l="ProgressBar-styles_bar__x0O50",d=0,f=.1;function v(r){var o,s,u,i,v,y=c(),m=y.defaultDuration,h=y.classNames,x=n.useRef(null),p=n.useRef(null),_=n.useState(!1),j=_[0],w=_[1];return n.useEffect((function(){!r.isPaused&&r.isActive&&r.isActive?w(!0):w(!1)}),[r.isActive,r.isPaused]),n.useEffect((function(){var e;x.current&&(r.hasStoryPassed?x.current.style.width="".concat(null===(e=null==p?void 0:p.current)||void 0===e?void 0:e.offsetWidth,"px"):x.current.style.width="0px")}),[r.hasStoryPassed,r.isActive]),o=function(e){var n;x.current&&p.current&&((d=Number((x.current.style.width||"1px").slice(0,x.current.style.width.length-2))||0)>p.current.offsetWidth?w(!1):(f=(null===(n=null==p?void 0:p.current)||void 0===n?void 0:n.offsetWidth)/((r.story.duration||m)/e),x.current.style.width="".concat(d+f,"px")))},s=j,u=n.useRef(),i=n.useRef(),v=n.useRef(o),n.useEffect((function(){v.current=o}),[o]),n.useEffect((function(){return!1!==s?(u.current=requestAnimationFrame((function e(n){if(null!=i.current){var t=n-i.current;v.current(t)}i.current=n,u.current=requestAnimationFrame(e)})),function(){cancelAnimationFrame(u.current),u.current=null,i.current=null}):function(){u.current&&(u.current=null),cancelAnimationFrame(u.current),i.current=null}}),[s]),e.jsx("div",t({className:"".concat(a," ").concat((null==h?void 0:h.progressBarContainer)||""),ref:p},{children:e.jsx("div",{className:"".concat(l," ").concat((null==h?void 0:h.progressBar)||""),ref:x})}))}var y="progress-styles_wrapper__qQPyW";function m(n){var r=c(),o=r.stories,s=r.classNames;return e.jsx("div",t({className:"".concat(y," ").concat((null==s?void 0:s.progressContainer)||""),style:{gridTemplateColumns:"repeat(".concat(o.length,",1fr)")}},{children:o.map((function(t){return e.jsx(v,{hasStoryPassed:t.index<n.activeStoryIndex,isActive:t.index===n.activeStoryIndex,story:t,isPaused:t.index===n.activeStoryIndex&&n.isPaused},t.index)}))}))}var h=Object.freeze({IMAGE:"image",VIDEO:"video",COMPONENT:"component"}),x="Story-styles_wrapper__oJP7j",p="Story-styles_header__-rnWL",_="Image-styles_image__gnfW1";function j(t){return n.useEffect((function(){t.onPause()}),[]),e.jsx("img",{className:_,src:t.story.url,alt:"story",onLoad:function(){setTimeout((function(){t.onResume()}),4)}})}var w,g="Video-styles_video__BykuO",S="Video-styles_loaderWrapper__TqVWk",E="Video-styles_loader__FxxSV",M="Video-styles_soundIcon__ZvYXE";function P(n){return"off"===n.type?e.jsx("svg",t({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"white"},{children:e.jsx("path",{d:"M3 9v6h-1v-6h1zm13-7l-9 5v2.288l7-3.889v13.202l-7-3.889v2.288l9 5v-20zm-11 5h-5v10h5v-10zm17.324 4.993l1.646-1.659-1.324-1.324-1.651 1.67-1.665-1.648-1.316 1.318 1.67 1.657-1.65 1.669 1.318 1.317 1.658-1.672 1.666 1.653 1.324-1.325-1.676-1.656z"})})):e.jsx("svg",t({xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"white"},{children:e.jsx("path",{d:"M22 0v24l-11-6v-2.278l9 4.909v-17.262l-9 4.91v-2.279l11-6zm-13 6v12h-7v-12h7zm-2 2h-3v8h3v-8z"})}))}var C="RSIsMute",N="undefined"==typeof window?{}:window;function R(r){var o,s=c().isPaused,u=n.useState("true"===(null===(o=null==N?void 0:N.localStorage)||void 0===o?void 0:o.getItem(C))),i=u[0],a=u[1],l=n.useState(!1),d=l[0],f=l[1],v=n.useRef(null);function y(e){var n;null===(n=null==N?void 0:N.localStorage)||void 0===n||n.setItem(C,String(e)),a(e)}return n.useEffect((function(){r.onPause(),f(!0)}),[]),n.useEffect((function(){v.current&&(!s||v.current.paused?v.current.play().catch((function(){var e;y(!0),null===(e=v.current)||void 0===e||e.play()})):v.current.pause())}),[s]),e.jsxs(n.Fragment,{children:[e.jsxs("video",t({className:g,ref:v,playsInline:!0,"webkit-playsinline":"",controls:!1,src:r.story.url,onLoadedData:function(){setTimeout((function(){r.onResume(),f(!1)}),4)},muted:i},{children:[e.jsx("source",{src:r.story.url,type:"video/mp4"}),e.jsx("source",{src:r.story.url,type:"video/webm"}),e.jsx("source",{src:r.story.url,type:"video/ogg"}),e.jsx("p",{children:"Video not supported"})]})),e.jsx("div",t({className:M,onClick:function(){return y(!i)}},{children:e.jsx(P,{type:i?"off":"on"})})),d&&e.jsx("div",t({className:S},{children:e.jsx("div",{className:E})}))]})}null===(w=null==N?void 0:N.localStorage)||void 0===w||w.setItem(C,"true");var T="CustomComponents-styles_component__w87Wx";function I(n){return e.jsx("div",t({className:T},{children:e.jsx(n.story.component,{pause:n.onPause,resume:n.onResume,story:n.story,isPaused:n.isPaused})}))}var O="SeeMore-styles_seeMoreWrapper__kwjif",D="SeeMore-styles_defaultSeeMore__-B1QW";function b(n){return n.story.seeMore?e.jsx("button",t({type:"button",onClick:function(){n.onSeeMoreClick()},className:O},{children:function(){var r=n.story.seeMore,o=typeof r;if(["string","boolean"].includes(o)){var s="string"===o?r:"See More";return e.jsxs("div",t({className:D},{children:[e.jsx("span",{children:"^"}),e.jsx("p",{children:s})]}))}return"function"===o?e.jsx(n.story.seeMore,{}):n.story.seeMore}()})):null}var A="SeeMoreComponent-styles_seeMoreComponentWrapper__0T6Ap",k="SeeMoreComponent-styles_closeIcon__LMm3b";function W(n){return n.story.seeMore&&n.story.seeMoreComponent?e.jsxs("div",t({className:A},{children:[e.jsx("button",t({className:k,onClick:n.onClose},{children:"âœ•"})),"function"==typeof n.story.seeMoreComponent?e.jsx(n.story.seeMoreComponent,{}):n.story.seeMoreComponent]})):null}function F(r){var o=n.useState(!1),s=o[0],u=o[1],i=c().classNames;return n.useEffect((function(){u(!1)}),[r.story]),e.jsxs("div",t({className:"".concat(x," ").concat((null==i?void 0:i.storyContainer)||"")},{children:[r.story.type===h.IMAGE?e.jsx(j,t({},r)):r.story.type===h.VIDEO?e.jsx(R,t({},r)):r.story.type===h.COMPONENT?e.jsx(I,t({},r)):null,r.story.header&&e.jsx("div",t({className:p},{children:"function"==typeof r.story.header?e.jsx(r.story.header,{}):r.story.header})),e.jsx(b,{onSeeMoreClick:function(){var e,n;r.onPause(),u(!0),null===(n=(e=r.story).onSeeMoreClick)||void 0===n||n.call(e,r.story.index)},story:r.story}),s&&e.jsx(W,{story:r.story,onClose:function(){r.onResume(),u(!1)}})]}))}var z="styles_main__-0FEu";function L(e){return void 0===e&&(e=4),Number(Math.random().toFixed(e))}module.exports=function(o){var s,u,c,a,l,d,f,v=o.stories,y=void 0===v?[]:v,h=o.width,x=void 0===h?"100%":h,p=o.height,_=void 0===p?"100%":p,j=o.onStoryChange,w=void 0===j?function(){}:j,g=o.currentIndex,S=void 0===g?0:g,E=o.defaultDuration,M=void 0===E?1e4:E,P=o.onAllStoriesEnd,C=void 0===P?function(){}:P,N=o.onStoriesStart,R=void 0===N?function(){}:N,T=o.classNames,I=void 0===T?{}:T,O=o.pauseStoryWhenInActiveWindow,D=void 0===O||O,b=n.useMemo((function(){return function(e,n){var r=0;return e.map((function(e,o){var s=e.duration||n,u=s+L();return u===r&&(u=s+L(6)),r=u,t(t({},e),{index:o,calculatedDuration:u})}))}(y,M)}),[y,M]),A=n.useState(),k=A[0],W=A[1],V=y.length-1,B=n.useState(!1),U=B[0],q=B[1],H=n.useRef(!1),G=n.useRef(!1);function Q(){H.current||(null==k?void 0:k.index)!==V||(C(),H.current=!0),(null==k?void 0:k.index)!==V&&W((function(e){if(!e)return b[0];var n=(null==e?void 0:e.index)+1;return b[n]}))}function J(){q(!0)}function X(){q(!1)}n.useEffect((function(){G.current||(G.current=!0,R())}),[R]),n.useEffect((function(){var e=b[S];e&&W(e)}),[S,y]),n.useEffect((function(){k&&w(k.index)}),[k]),u=function(){Q()},c=null!==(s=null==k?void 0:k.calculatedDuration)&&void 0!==s?s:null,a=U,l=n.useRef(),d=n.useRef(c),f=n.useRef(Date.now()),n.useEffect((function(){l.current=u}),[u]),n.useEffect((function(){d.current=c}),[c]),n.useEffect((function(){if(null!==c&&!1===a){f.current=Date.now();var e=setTimeout((function(){l.current()}),d.current);return function(){clearTimeout(e)}}return function(){}}),[c,a]),n.useEffect((function(){a&&(d.current=d.current-(Date.now()-f.current))}),[a]),function(e){var t=n.useRef(e);n.useEffect((function(){t.current=e}),[e]),n.useEffect((function(){function e(){t.current(!0)}function n(){t.current(!1)}return window.addEventListener("focus",e),window.addEventListener("blur",n),function(){window.removeEventListener("focus",e),window.removeEventListener("blur",n)}}),[])}((function(e){D&&q(!e)}));var Y={stories:b,width:x,height:_,defaultDuration:M,isPaused:U,classNames:I};return k?e.jsx(r.Provider,t({value:Y},{children:e.jsxs("div",t({className:"".concat(z," ").concat(I.main||""),style:{width:x,height:_}},{children:[e.jsx(m,{activeStoryIndex:k.index,isPaused:U}),e.jsx(F,{onPause:J,onResume:X,story:k,isPaused:U},k.index),e.jsx(i,{onNextClick:Q,onPrevClick:function(){0!==(null==k?void 0:k.index)&&W((function(e){if(!e)return b[0];var n=(null==e?void 0:e.index)-1;return b[n]}))},onPause:J,onResume:X})]}))})):null};
//# sourceMappingURL=index.js.map
